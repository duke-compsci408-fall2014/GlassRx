package com.compsci408.requests;

import java.io.IOException;
import java.io.InputStream;
import java.net.HttpURLConnection;
import java.net.URL;

import org.json.JSONArray;

import com.compsci408.datatypes.Constants;

import android.os.AsyncTask;
import android.util.Log;

public class GetTask extends AsyncTask<String, Void, String> {
	private static final String TAG = "GetTask";
	
	private InputStream is = null;
	private ResponseCallback mCallback;
	
	@Override
	protected String doInBackground(String... address) {
		URL url;
		String result = null;
		try {
	        url = new URL(address[0]);

	        HttpURLConnection urlConnection = (HttpURLConnection) url.openConnection();
	        
	        urlConnection.setReadTimeout(Constants.READ_TIMEOUT);
	        urlConnection.setConnectTimeout(Constants.CONNECT_TIMEOUT);
	        urlConnection.setRequestMethod(Constants.GET);
	        urlConnection.setDoInput(true);
	        urlConnection.connect();
	        
	        int response = urlConnection.getResponseCode();
	        Log.d(TAG, "Server response code:  " + response);
	        is = urlConnection.getInputStream();
	        
	        result = NetworkUtils.readStream(is);
	    } catch (Exception e) {
	    	// TODO:  Improve exception handling
	        e.printStackTrace();
	    } finally {
	    	try {
	    		is.close();
	    	} catch (IOException e) {
	    		// TODO:  Improve exception handling
	    		e.printStackTrace();
	    	}
	    }
		return result;
	}

}
